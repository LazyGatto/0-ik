[gcode_macro PRINT_START]
gcode:
    G90
    M107
    M82
    G28
    G1 Z20 F3000
    G92 E0
    G1 X110 Y0.5 F2000
    G1 Z0.28 F400
    G1 X30 Y0.5 E18 F1000
    G1 Z0.5 F200
    G92 E0

[gcode_macro PRINT_END]
gcode:
    M400
    G92 E0
    G1 E-4.0 F3600
    G91
    {% set vars = printer['gcode_macro GLOBAL_VARS'] %}
    {% set max_x = vars.variable_bed_x|float %}
    {% set max_y = vars.variable_bed_y|float %}
    {% set max_z = vars.variable_bed_z|float %}
    {% set desired_z_lift = 50.0 %}
    {% set remaining_z = (max_z - printer.toolhead.position.z)|float %}
    {% if remaining_z < 0 %}
        {% set remaining_z = 0.0 %}
    {% endif %}
    {% if printer.toolhead.position.x < (max_x - 20) %}
        {% set x_safe = 20.0 %}
    {% else %}
        {% set x_safe = -20.0 %}
    {% endif %}
    {% if printer.toolhead.position.y < (max_y - 20) %}
        {% set y_safe = 20.0 %}
    {% else %}
        {% set y_safe = -20.0 %}
    {% endif %}
    {% if remaining_z > desired_z_lift %}
        {% set z_safe = desired_z_lift %}
    {% else %}
        {% set z_safe = remaining_z %}
    {% endif %}
    G0 Z{z_safe} F3600
    G0 X{x_safe} Y{y_safe} F20000
    TURN_OFF_HEATERS
    M107
    G90
    G0 X60 Y0 F3600
    SET_SKEW CLEAR=1
